import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Card, CardContent } from "@/components/ui/card";
import { Phone, CheckCircle, Loader2 } from "lucide-react";

const contactList = [
  { id: 1, name: "Jo√£o da Silva", phone: "11999990001" },
  { id: 2, name: "Maria Oliveira", phone: "11988880002" },
  { id: 3, name: "Carlos Santos", phone: "11977770003" },
];

export default function DiscadorAuto() {
  const [current, setCurrent] = useState(0);
  const [calling, setCalling] = useState(false);
  const [log, setLog] = useState([]);

  const iniciarChamada = () => {
    if (current >= contactList.length) return;
    setCalling(true);
    const contato = contactList[current];
    setLog((prev) => [...prev, `üìû Chamando ${contato.name} (${contato.phone})...`]);

    setTimeout(() => {
      setLog((prev) => [...prev, `‚úÖ ${contato.name} finalizado.`]);
      setCurrent((prev) => prev + 1);
      setCalling(false);
    }, 3000);
  };

  useEffect(() => {
    if (!calling && current < contactList.length) {
      iniciarChamada();
    }
  }, [calling, current]);

  return (
    <div className="max-w-2xl mx-auto p-6 space-y-6">
      <h1 className="text-2xl font-bold">Discador Autom√°tico</h1>
      <Card>
        <CardContent className="space-y-4 p-4">
          <p>Lista de Contatos: {contactList.length}</p>
          <p>Contato Atual: {current + 1 <= contactList.length ? `${contactList[current]?.name} (${contactList[current]?.phone})` : "Todos processados."}</p>
          <Button onClick={iniciarChamada} disabled={calling || current >= contactList.length}>
            {calling ? (
              <>
                <Loader2 className="animate-spin mr-2" /> Chamando...
              </>
            ) : (
              <>
                <Phone className="mr-2" /> Iniciar Chamada
              </>
            )}
          </Button>
        </CardContent>
      </Card>

      <div className="bg-gray-100 rounded p-4 text-sm h-64 overflow-y-auto">
        {log.map((item, i) => (
          <div key={i}>{item}</div>
        ))}
      </div>
    </div>
  );
}
